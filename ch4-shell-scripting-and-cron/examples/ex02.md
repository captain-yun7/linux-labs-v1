### ex02 : 백업 자동화 및 오래된 파일 삭제 (Cron, find)

#### 1\. 백업 스크립트를 매일 새벽 2시에 실행하기

`crontab -e` 명령어로 편집기를 열고, 아래 내용을 추가합니다. 스크립트의 경로는 **전체 경로**로 정확하게 지정해야 합니다.

```crontab
# 매일 새벽 2시에 백업 스크립트를 실행합니다.
# 실행 결과로 나오는 메시지(Standard Output)와 에러(Standard Error)를
# 백업 로그 파일에 기록하여 나중에 확인할 수 있게 합니다.
0 2 * * * /home/ubuntu/backup.sh >> /home/ubuntu/backups/backup.log 2>&1
```
- `>> backup.log`: 실행 결과를 `backup.log` 파일 끝에 추가합니다.
- `2>&1`: 에러(2)가 발생하면 결과(1)와 같은 곳으로 보냅니다. 즉, 성공/실패 메시지 모두 로그에 기록됩니다.

#### 2\. 오래된 백업 파일 자동 삭제 스크립트 작성

백업이 계속 쌓이면 디스크가 가득 찰 수 있습니다. 7일이 지난 백업 파일은 자동으로 삭제하는 스크립트(`cleanup.sh`)를 만듭니다.

```bash
#!/bin/bash

# [변수 선언] - 백업 디렉토리와 보관 기간(일)을 지정합니다.
BACKUP_DIR="/home/ubuntu/backups"
RETENTION_DAYS=7

echo "오래된 백업 파일 정리를 시작합니다..."

# [find 명령어 활용]
# $BACKUP_DIR 경로에서 (-path)
# 이름이 'backup-*.tar.gz' 패턴과 일치하고 (-name)
# 수정한 지 $RETENTION_DAYS 보다 오래된 (-mtime +$RETENTION_DAYS)
# 파일을 (-type f) 찾아서 (-exec) 삭제합니다 (rm -f {} \;).
find "$BACKUP_DIR" -path "*/backup-*.tar.gz" -mtime +"$RETENTION_DAYS" -type f -exec rm -f {} \;

echo "정리가 완료되었습니다."
```
*`cleanup.sh` 파일에도 `chmod +x`로 실행 권한을 부여하는 것을 잊지 마세요.*

#### 3\. 정리 스크립트를 매주 일요일 새벽 3시에 실행하기

다시 `crontab -e`를 실행하여 아래 내용을 추가합니다.

```crontab
# 매주 일요일(요일=0) 새벽 3시에 오래된 백업 파일 정리 스크립트를 실행합니다.
0 3 * * 0 /home/ubuntu/cleanup.sh >> /home/ubuntu/backups/cleanup.log 2>&1
```

이제 매일 자동으로 백업을 수행하고, 매주 일요일마다 오래된 백업을 청소하는 완벽한 자동화 시스템이 구축되었습니다. 