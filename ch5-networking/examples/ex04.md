### ex04 : 서버의 문 단속하기 (ufw 방화벽)

`ufw` (Uncomplicated Firewall)는 복잡한 `iptables`를 쉽게 사용할 수 있도록 만든 방화벽 관리 도구입니다. 특정 IP나 포트에 대한 접근 제어를 간단한 명령어로 설정할 수 있습니다.

#### 1\. ufw 상태 확인 및 활성화

```bash
# [ufw 설치 확인] - 대부분의 Ubuntu 배포판에 기본 설치되어 있습니다.
sudo apt install ufw

# [현재 ufw 상태 확인]
sudo ufw status
# 기본적으로 비활성화(inactive) 상태입니다.

# [ufw 활성화] - 활성화하는 순간 기본적으로 모든 외부에서의 접속(incoming)을 차단합니다.
# SSH 접속이 끊길 수 있다는 경고가 나타납니다. SSH 포트를 먼저 열어줘야 합니다.
sudo ufw enable

# [ufw 비활성화]
sudo ufw disable
```

#### 2\. 기본적인 규칙 설정 (SSH, HTTP, HTTPS)

**가장 중요한 규칙:** `ufw`를 활성화하기 전에 **반드시 현재 접속한 SSH 포트를 먼저 허용**해야 합니다. 그렇지 않으면 서버에 다시 접속할 수 없게 될 수 있습니다.

```bash
# [SSH 포트(22) 허용]
sudo ufw allow 22/tcp
# 또는 서비스 이름으로 허용
sudo ufw allow ssh

# [웹 서버 포트 허용]
sudo ufw allow 80/tcp   # HTTP
sudo ufw allow 443/tcp  # HTTPS
sudo ufw allow http
sudo ufw allow https

# [규칙 적용 후 ufw 활성화]
sudo ufw enable

# [설정된 규칙 목록 확인]
sudo ufw status verbose
```

#### 3\. 특정 IP 주소에 대한 접근 제어

특정 IP 주소나 대역에 대해서만 접속을 허용하거나 차단할 수 있습니다.

```bash
# [내 사무실 IP(예: 123.45.67.89)에서 오는 모든 연결 허용]
sudo ufw allow from 123.45.67.89

# [특정 IP에서 특정 포트(DB)로의 접속만 허용]
sudo ufw allow from 123.45.67.89 to any port 3306

# [특정 IP(공격자)의 모든 접근 차단]
sudo ufw deny from 98.76.54.32
```

#### 4\. 규칙 삭제

```bash
# [설정된 규칙에 번호 붙여서 보기]
sudo ufw status numbered

# [번호로 규칙 삭제] - 2번 규칙을 삭제합니다.
sudo ufw delete 2

# [규칙 내용으로 직접 삭제]
sudo ufw delete allow ssh
``` 